{  
   "index_patterns":[
      "nginx-*"
   ],
   "settings":{
      "index":{
         "codec":"best_compression",
         "mapping":{
            "total_fields":{
               "limit": 1000
            }
         },         
         "number_of_shards":"{{ (.Values.data.replicas | int) }}",
         "number_of_replicas":"{{ (sub (.Values.data.replicas | int) 1) }}",
         "refresh_interval":"5s"
      }
   },
   "mappings":{
      "_source":{
         "enabled":true
      },
      "dynamic_templates":[
         {
            "kubernetes.annotations.*":{
               "mapping":{
                  "type":"keyword"
               },
               "match_mapping_type":"*",
               "path_match":"kubernetes.annotations.*"
            }
         },          
         {
            "kubernetes.labels.*":{
               "mapping":{
                  "type":"keyword"
               },
               "match_mapping_type":"*",
               "path_match":"kubernetes.labels.*"
            }
         } 
      ],
      "properties":{
         "@timestamp":{
            "type":"date"
         },
         "kubernetes":{
            "properties":{
               "container_name":{
                  "type":"keyword",
                  "ignore_above":"256"
               },
               "container_image":{
                  "type":"keyword",
                  "ignore_above":"256"
               },
               "container_hash":{
                  "type":"keyword",
                  "ignore_above":"256"
               },
               "docker_id":{
                  "type":"keyword",
                  "ignore_above":"256"
               },
               "host":{
                  "type":"keyword",
                  "ignore_above":"256"
               },
               "namespace_name":{
                  "type":"keyword",
                  "ignore_above":"256"
               },
               "pod_id":{
                  "type":"keyword",
                  "ignore_above":"256"
               },
               "pod_name":{
                  "type":"keyword",
                  "ignore_above":"256"
               }               
            }
         },
         "log":{
            "type":"text"
         },
         "agent":{
           "type":"keyword"
         },
         "code":{
            "type":"keyword"            
         },
         "host":{
            "type":"keyword"            
         },
         "method":{
            "type":"keyword"            
         },
         "path":{
            "type":"keyword"            
         },
         "proxy_upstream_name":{
            "type":"keyword"            
         },
         "referrer":{
            "type":"keyword"
         },
         "reg_id":{
            "type":"keyword"
         },
         "request_length":{
            "type":"long"
         },
         "request_time":{
            "type":"double"
         },
         "size":{
           "type":"long"
         },
         "upstream_addr":{
            "type":"keyword"
         },
         "upstream_response_length":{
            "type":"long"
         },
         "upstream_response_time":{
            "type":"double"
         },
         "upstream_status":{
            "type":"keyword"
         },
         "user":{
            "type":"keyword"            
         }
      }
   }
}